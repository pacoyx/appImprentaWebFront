<h2>Services</h2>
<hr>

<button class="btn btn-primary" (click)="nuevoServicio()">
    <i class="far fa-file-alt"></i> New</button>
<span class="ml-2"></span>
<button class="btn btn-primary" (click)="cargarServicios()">
    <i class="fas fa-sync-alt"></i> </button>
<span class="ml-3"></span>
<div class="form-check form-check-inline">
    <input class="form-check-input" type="checkbox" [(ngModel)]="chkFiltro" id="filtro" name="filtro"
        (change)="refreshVista($event)">

    <label for="filtro"> All Services</label>
</div>




<!-- <button class="btn btn-outline-primary" (click)="descargarFile()">
        <i class="far fa-file-alt"></i> descargar File</button> -->
<hr>


<!-- <span *ngIf="bolCargandoServis"></span> -->


<div *ngIf="bolCargandoServis" class="text-center">
    <app-trinity-rings-spinner [animationDuration]="1500" [size]="66" [color]="'rgb(14, 93, 212)'">
    </app-trinity-rings-spinner>
    Cargando...
</div>


<table class="table table-striped table-inverse table-responsive" *ngIf="!bolCargandoServis">
    <thead class="thead-inverse">
        <tr>
            <th>Action</th>
            <th>IDS</th>
            <th>ITEM</th>
            <th>CREATION.DATE</th>
            <th>USER</th>
            <th>CUSTOMER</th>
            <th>ART.VENTA</th>
            <th>ART.GRAFICO</th>
            <th>TYPE</th>
            <th>DESCRIPTION</th>
            <th>DATE-ENTREGA-PROVE</th>
            <th>DATE-ENTREGA-VENTA</th>
            <th>STATUS</th>

        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let item of arrServicios">
            <td>
                <button class="btn btn-warning btn-sm" (click)="listaVersionxServicio(item)">FLOW</button>
                <span class="m-1"></span>
                <button class="btn btn-secondary btn-sm" (click)="addVersion(item)">ADD</button>
            </td>

            <td scope="row">{{item.idservicio}}</td>
            <td>{{item.item}}</td>
            <td>{{item.fechaCreacion | date}}</td>
            <td>{{item.idusuario}}</td>
            <td>{{item.idcliente}}</td>
            <td>{{item.codigoArticuloVenta}}</td>
            <td>{{item.codigoArticuloGrafico}}</td>
            <td>{{item.tipo}}</td>
            <td>{{item.descripcion}}</td>
            <td>{{item.fechaEntregaProveedor | date}}</td>
            <td>{{item.fechaEntregaVenta | date}}</td>
            <td>{{item.estado}}</td>

        </tr>
    </tbody>
</table>

<!-- modal para ver lista de versiones -->
<ng-template #modalVersiones let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">List Versions</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">×</span>
        </button>
    </div>
    <div class="modal-body">

        <div class="container">
            <h5>N° SERVICE : {{idServicio}}</h5>
            <hr>
            <div *ngFor="let item of arrVersiones; let i=index" style="text-align:center;">
                <div class="card border-secondary  mb-3" style="max-width: 18rem; margin:0px auto;">
                    <div class="card-header">Version : {{item.item}} | <span
                            class="text-right ml-2"><small>{{item.usuario}}</small> </span> </div>
                    <div class="card-body text-secondary">
                        <h5 class="card-title">{{item.tipo}}</h5>
                        <p>Date : {{item.fecha | date}}</p>
                        <!-- <p>File : {{item.nombreArchivo}}</p> -->
                        <p class="card-text">Comment : {{item.comentario}}</p>
                        <button class="btn btn-info btn btn-sm btn-block" (click)="descargarFile(item)">
                            <i class="fas fa-download"></i> {{item.nombreArchivoOriginal}}</button>
                    </div>

                </div>
                <div class="text-center m-2" *ngIf="arrVersiones.length !== (i+1)">
                    <i class="fas fa-long-arrow-alt-down fa-2x"></i>
                </div>
            </div>

        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.close('Save click')">Close</button>
    </div>
</ng-template>

<!-- modal para nueva version -->
<ng-template #modalData let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">New Version</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">×</span>
        </button>
    </div>
    <div class="modal-body">

        <div class="container">
            <form [formGroup]="form" (ngSubmit)="submitFormGrabarVersion()">

                <div class="form-group">
                    <label for="usuario">User</label>
                    <input class="form-control" formControlName="usuario" id="usuario">
                </div>

                <div class="form-group">
                    <div class="row">
                        <div class="col">
                            <label for="servicio">IDService</label>
                            <input class="form-control" formControlName="idservicio" id="servicio">
                        </div>
                        <div class="col">
                            <label for="itemWork">Item</label>
                            <input class="form-control" formControlName="servicioItem" id="itemWork">
                        </div>
                    </div>

                </div>

                <div class="form-group">
                    <label for="tipo">Type Version</label>
                    <select id="tipo" class="form-control" formControlName="tipo">
                        <option *ngFor="let item of arrTipoVersion" [value]="item">{{item}}</option>
                    </select>
                </div>

                <div class="form-group" *ngIf="usuarioSis.profileUser !== 'CALIDAD'">
                    <label for="carga">Select File</label>
                    <input type="file" (change)="uploadFile($event)" id="carga" class="form-control">
                </div>

                <div class="form-group">
                    <textarea id="carga" cols="30" rows="10" placeholder="Comentarios" formControlName="comentario"
                        class="form-control"></textarea>
                </div>

                <div class="form-group">
                    <button class="btn btn-primary btn-block btn-lg">Create</button>
                </div>
            </form>
        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.close('Save click')">Close</button>
    </div>
</ng-template>

<!-- modal para cargar excel -->
<ng-template #modalImport let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">Import File Excel for Service</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">×</span>
        </button>
    </div>
    <div class="modal-body">

        <div class="container">

            <form [formGroup]="formExcel">
                <div class="form-group">
                    <label for="usuario">User</label>
                    <input class="form-control" id="usuario" formControlName="usuario">
                </div>

                <div class="form-group">
                    <label for="cliente">Client</label>
                    <input class="form-control" id="cliente" formControlName="cliente">
                </div>
            </form>


            <input type="file" (change)="onFileChange($event)">

            <table id="contactJs" class="table table-striped table-inverse table-responsive">
                <tr class="thead">
                    <th>refOrdine</th>
                    <th>refArticoloVendita</th>
                    <th>codArticoloMaterialeGrafico</th>
                    <th>AttivitaRichiesta</th>
                    <th>DescrizioneArticolo</th>
                    <th>DataRichiestaMaterialeFornitore</th>
                    <th>DataScadRichiestaFileGrafico</th>
                </tr>
                <tr class="tbody" *ngFor="let contact of importContacts; let odd = odd" [ngClass]="{'odd': odd}">
                    <td>{{contact?.refOrdine}}</td>
                    <td>{{contact?.refArticoloVendita}}</td>
                    <td>{{contact?.codArticoloMaterialeGrafico}}</td>
                    <td>{{contact?.AttivitaRichiesta}}</td>
                    <td>{{contact?.DescrizioneArticolo}}</td>
                    <td>{{contact?.DataRichiestaMaterialeFornitore | date:'dd-MM-yyyy'}}</td>
                    <td>{{contact?.DataScadRichiestaFileGrafico | date:'dd-MM-yyyy'}}</td>
                </tr>
            </table>

            <button class="btn btn-primary" (click)="registrarServicioExcel()"><i class="fas fa-check"></i> ok,
                import</button>
        </div>

    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.close('Save click')">Close</button>
    </div>
</ng-template>